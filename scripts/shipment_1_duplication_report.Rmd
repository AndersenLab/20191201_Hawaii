---
title: "20191201_Hawaii_Shipment1_report"
author: "Tim C."
date: "12/17/2019"
output:
  html_document:
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
---
```{r, echo=F, warning = F, message=F}
# load packages
library(tidyverse)
library(ggmap)
library(memoise)
library(lubridate)
library(cowplot)
library(pals)
library(grid)
library(gridExtra)
library(scales)
library(kableExtra)
library(leaflet)
library(htmlwidgets)
library(htmltools)

#setting working directory
knitr::opts_knit$set(root.dir = '..')
```

### duplications report
```{r, echo=F, warning = F, message=F}
##########################################################################
# part 1 find duplications in nematode nematode_field_sampling.csv     ###
##########################################################################
`duplication in nematode_field_sampling.csv` <- readr::read_csv("data/fulcrum/shipment_1/nematode_field_sampling.csv") %>%
  add_count(c_label) %>%
  dplyr::filter(n > 1)

n_duplicated_field_sampling <- `duplication in nematode_field_sampling.csv` %>%
  #conditional pipe to return NA if dataframe is empty and move on to count c_labels if not empty.
    {if (nrow(.) == 0) return(0) else (.) %>%
  dplyr::distinct(c_label) %>%
  dplyr::mutate(pull_n = n()) %>%
  dplyr::distinct(pull_n) %>%
  dplyr::pull(pull_n)
    }

knitr::kable(`duplication in nematode_field_sampling.csv`, caption = glue::glue("{n_duplicated_field_sampling} c_label(s) duplicated in nematode_field_sampling.csv")) %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "200px")

#########################################################################
# part 2  find duplicate records in nematode_isolation.csv            ###
#########################################################################
`duplication in nematode_isolation.csv` <- readr::read_csv("data/fulcrum/shipment_1/nematode_isolation.csv") %>%
  add_count(fulcrum_id) %>%
  dplyr::rename(distinct_fulcrum_id_count = n) %>%
  add_count(c_label) %>%
  dplyr::rename(distinct_c_label_count = n)

# get count of duplicated isolation ids
n_duplicated_isolations <- `duplication in nematode_isolation.csv` %>%
  dplyr::filter(distinct_fulcrum_id_count > 1) %>%
  #conditional pipe to return NA if dataframe is empty and move on to count fulcrum_ids if not empty.
    {if (nrow(.) == 0) return(0) else (.) %>%
  dplyr::distinct(fulcrum_id) %>%
  dplyr::mutate(pull_n = n()) %>%
  dplyr::distinct(pull_n) %>%
  dplyr::pull(pull_n)
    }

`duplicated isolation ids in nematode_isolation.csv` <-  `duplication in nematode_isolation.csv` %>% dplyr::filter(distinct_fulcrum_id_count >1)
knitr::kable(`duplicated isolation ids in nematode_isolation.csv`, caption = glue::glue("{n_duplicated_isolations} isolation id(s) duplicated in nematode_isolation.csv")) %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "200px")

# get count of multiple isolation ids for a single collection
n_multiple_isolations_for_collection <- `duplication in nematode_isolation.csv` %>%
  dplyr::filter(distinct_c_label_count > 1) %>%
  #conditional pipe to return NA if dataframe is empty and move on to count c_labels if not empty. Need (.) b/c you can't have . alone on the left side of a pipe!
    {if (nrow(.) == 0) return(0) else (.) %>%
  dplyr::distinct(c_label) %>%
  dplyr::mutate(pull_n = n()) %>%
  dplyr::distinct(pull_n) %>%
  dplyr::pull(pull_n)
    }
    
`duplicated isolations for same collection` <- `duplication in nematode_isolation.csv` %>% dplyr::filter(distinct_c_label_count >1)
knitr::kable(`duplicated isolations for same collection`, caption = glue::glue("{n_multiple_isolations_for_collection} collection(s) with duplicated isolations in nematode_isolation.csv")) %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "200px")

#########################################################################
# part 3 find duplications in nematode isolation_s_labeled_plates.csv ###
#########################################################################
`duplication in nematode_isolation_s_labeled_plates.csv` <- readr::read_csv("data/fulcrum/shipment_1/nematode_isolation_s_labeled_plates.csv") %>%
  add_count(s_label) %>%
  dplyr::filter(n > 1) %>%
  dplyr::arrange(s_label)

# get count of duplicated isolations in nematode isolation_s_labeled_plates.csv
n_duplicated_isolations_s_labeled_plates <- `duplication in nematode_isolation_s_labeled_plates.csv` %>%
  #conditional pipe to return NA if dataframe is empty and move on to count s_labels if not empty. Need (.) b/c you can't have . alone on the left side of a pipe!
    {if (nrow(.) == 0) return(0) else (.) %>%
  dplyr::distinct(s_label) %>%
  dplyr::mutate(pull_n = n()) %>%
  dplyr::distinct(pull_n) %>%
  dplyr::pull(pull_n)
    }

knitr::kable(`duplication in nematode_isolation_s_labeled_plates.csv`, caption =  glue::glue("{n_duplicated_isolations_s_labeled_plates} s_label(s) duplicated in nematode_isolation_s_labeled_plates.csv")) %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "200px")


```
<br> These dataframes are filtered to show the duplications in the raw data from fulcrum or the genotyping sheet. If the dataframe are empty there is no duplication.

### duplications report without change set or history export
```{r, echo=F, warning = F, message=F}
##########################################################################
# part 1 find duplications in nematode nematode_field_sampling.csv     ###
##########################################################################
`duplication in nematode_field_sampling.csv` <- readr::read_csv("data/fulcrum/shipment_1_no_changeset/nematode_field_sampling.csv") %>%
  add_count(c_label) %>%
  dplyr::filter(n > 1)

n_duplicated_field_sampling <- `duplication in nematode_field_sampling.csv` %>%
  #conditional pipe to return NA if dataframe is empty and move on to count c_labels if not empty.
    {if (nrow(.) == 0) return(0) else (.) %>%
  dplyr::distinct(c_label) %>%
  dplyr::mutate(pull_n = n()) %>%
  dplyr::distinct(pull_n) %>%
  dplyr::pull(pull_n)
    }

knitr::kable(`duplication in nematode_field_sampling.csv`, caption = glue::glue("{n_duplicated_field_sampling} c_label(s) duplicated in nematode_field_sampling.csv")) %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "200px")

#########################################################################
# part 2  find duplicate records in nematode_isolation.csv            ###
#########################################################################
`duplication in nematode_isolation.csv` <- readr::read_csv("data/fulcrum/shipment_1_no_changeset/nematode_isolation.csv") %>%
  add_count(fulcrum_id) %>%
  dplyr::rename(distinct_fulcrum_id_count = n) %>%
  add_count(c_label) %>%
  dplyr::rename(distinct_c_label_count = n)

# get count of duplicated isolation ids
n_duplicated_isolations <- `duplication in nematode_isolation.csv` %>%
  dplyr::filter(distinct_fulcrum_id_count > 1) %>%
  #conditional pipe to return NA if dataframe is empty and move on to count fulcrum_ids if not empty.
    {if (nrow(.) == 0) return(0) else (.) %>%
  dplyr::distinct(fulcrum_id) %>%
  dplyr::mutate(pull_n = n()) %>%
  dplyr::distinct(pull_n) %>%
  dplyr::pull(pull_n)
    }

`duplicated isolation ids in nematode_isolation.csv` <-  `duplication in nematode_isolation.csv` %>% dplyr::filter(distinct_fulcrum_id_count >1)
knitr::kable(`duplicated isolation ids in nematode_isolation.csv`, caption = glue::glue("{n_duplicated_isolations} isolation id(s) duplicated in nematode_isolation.csv")) %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "200px")

# get count of multiple isolation ids for a single collection
n_multiple_isolations_for_collection <- `duplication in nematode_isolation.csv` %>%
  dplyr::filter(distinct_c_label_count > 1) %>%
  #conditional pipe to return NA if dataframe is empty and move on to count c_labels if not empty. Need (.) b/c you can't have . alone on the left side of a pipe!
    {if (nrow(.) == 0) return(0) else (.) %>%
  dplyr::distinct(c_label) %>%
  dplyr::mutate(pull_n = n()) %>%
  dplyr::distinct(pull_n) %>%
  dplyr::pull(pull_n)
    }
    
`duplicated isolations for same collection` <- `duplication in nematode_isolation.csv` %>% dplyr::filter(distinct_c_label_count >1)
knitr::kable(`duplicated isolations for same collection`, caption = glue::glue("{n_multiple_isolations_for_collection} collection(s) with duplicated isolations in nematode_isolation.csv")) %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "200px")

#########################################################################
# part 3 find duplications in nematode isolation_s_labeled_plates.csv ###
#########################################################################
`duplication in nematode_isolation_s_labeled_plates.csv` <- readr::read_csv("data/fulcrum/shipment_1_no_changeset/nematode_isolation_s_labeled_plates.csv") %>%
  add_count(s_label) %>%
  dplyr::filter(n > 1) %>%
  dplyr::arrange(s_label)

# get count of duplicated isolations in nematode isolation_s_labeled_plates.csv
n_duplicated_isolations_s_labeled_plates <- `duplication in nematode_isolation_s_labeled_plates.csv` %>%
  #conditional pipe to return NA if dataframe is empty and move on to count s_labels if not empty. Need (.) b/c you can't have . alone on the left side of a pipe!
    {if (nrow(.) == 0) return(0) else (.) %>%
  dplyr::distinct(s_label) %>%
  dplyr::mutate(pull_n = n()) %>%
  dplyr::distinct(pull_n) %>%
  dplyr::pull(pull_n)
    }

knitr::kable(`duplication in nematode_isolation_s_labeled_plates.csv`, caption =  glue::glue("{n_duplicated_isolations_s_labeled_plates} s_label(s) duplicated in nematode_isolation_s_labeled_plates.csv")) %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "200px")


```
<br> These dataframes are filtered to show the duplications in the raw data from fulcrum or the genotyping sheet. If the dataframe are empty there is no duplication.